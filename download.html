<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç¤¾æœƒå±€ - åª’é«”ä¸‹è¼‰æ¨¡çµ„</title>
  <style>
    body { margin: 0; background: #000; color: #0f0; font-family: 'Courier New', monospace; overflow: hidden; }
    canvas { position: fixed; top: 0; left: 0; z-index: -1; opacity: 0.35; }

    .wrap{
      position:absolute; inset:0;
      display:grid; place-items:center;
      padding: 24px;
    }

    .panel{
      width: min(820px, 94vw);
      border: 1px solid rgba(0,255,0,0.45);
      background: rgba(0, 12, 0, 0.55);
      box-shadow: 0 0 26px rgba(0,255,0,0.14);
      padding: 18px 18px 16px;
      backdrop-filter: blur(6px);
    }

    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap: 12px; margin-bottom: 12px;
    }
    .title{
      font-size: 1.1rem;
      letter-spacing: 4px;
      color: #e8ffe8;
      text-shadow: 0 0 12px rgba(0,255,0,0.35);
    }
    .badge{
      font-size: .85rem;
      padding: 6px 10px;
      border: 1px solid rgba(0,255,0,0.35);
      color: rgba(0,255,0,0.85);
      background: rgba(0,0,0,0.35);
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 180px 160px;
      gap: 10px;
    }

    input, select{
      padding: 12px 12px;
      background: rgba(0,0,0,0.6);
      color: #0f0;
      border: 1px solid rgba(0,255,0,0.42);
      outline: none;
      font-size: 1rem;
      font-family: 'Courier New', monospace;
    }

    .btn{
      padding: 12px 14px;
      border: 1px solid #0f0;
      background: transparent;
      color: #0f0;
      cursor: pointer;
      font-size: 1rem;
      transition: .2s;
      white-space: nowrap;
    }
    .btn:hover{ background: rgba(0,255,0,0.16); box-shadow: 0 0 18px rgba(0,255,0,0.45); }

    .subgrid{
      display:flex; gap:10px; margin-top: 10px; flex-wrap: wrap;
    }
    .btn.secondary{
      border-color: rgba(0,255,0,0.55);
      color: rgba(0,255,0,0.85);
      opacity: .9;
    }
    .btn.secondary:hover{ opacity: 1; }

    .hint{
      margin-top: 12px;
      font-size: .92rem;
      color: rgba(0,255,0,0.72);
      line-height: 1.5;
    }

    .result{
      margin-top: 12px;
      padding: 12px;
      border: 1px dashed rgba(0,255,0,0.35);
      background: rgba(0,0,0,0.38);
      color: #fff;
      line-height: 1.6;
      min-height: 54px;
      word-break: break-all;
    }
    .result a{ color:#00BFFF; text-decoration:none; }
    .result a:hover{ text-decoration:underline; }

    .footer{
      margin-top: 10px;
      display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
      font-size: .88rem;
      color: rgba(0,255,0,0.6);
    }
    .linklike{ cursor:pointer; }
    .linklike:hover{ text-decoration: underline; }

    @media (max-width: 760px){
      .grid{ grid-template-columns: 1fr; }
      .panel{ padding: 16px; }
    }
  </style>
</head>
<body>
  <canvas id="matrix"></canvas>

  <div class="wrap">
    <div class="panel">
      <div class="topbar">
        <div class="title">ã€ åª’ é«” ä¸‹ è¼‰ æ¨¡ çµ„ ã€‘</div>
        <div class="badge">SECURE CHANNEL</div>
      </div>

      <div class="grid">
        <input id="url" placeholder="è²¼ä¸Šä½ ã€æœ‰æ¬Šé™/æˆæ¬Šã€çš„åª’é«”ç¶²å€ï¼ˆæˆ–ç›´é€£ mp3/mp4ï¼‰" />
        <select id="type">
          <option value="video">å½±ç‰‡ MP4</option>
          <option value="audio">éŸ³æª” MP3</option>
        </select>
        <button class="btn" onclick="go()">é–‹å§‹è™•ç†</button>
      </div>

      <div class="subgrid">
        <button class="btn secondary" onclick="fillExample('direct')">å¡«å…¥ç¤ºä¾‹ï¼šç›´é€£</button>
        <button class="btn secondary" onclick="fillExample('other')">å¡«å…¥ç¤ºä¾‹ï¼šä¸€èˆ¬ç¶²å€</button>
        <button class="btn secondary" onclick="history.back()">â† è¿”å›ä¸Šä¸€é </button>
      </div>

      <div class="hint">
        âœ” è‹¥ä½ è²¼çš„æ˜¯ <b>mp3/mp4 ç›´é€£</b>ï¼šæœƒç›´æ¥çµ¦ä½ ä¸‹è¼‰é€£çµã€‚<br/>
        âœ” è‹¥æ˜¯ä¸€èˆ¬ç¶²å€ï¼šæœƒå˜—è©¦å‘¼å«ä½ çš„ NAS ä¸‹è¼‰æœå‹™ï¼ˆéœ€è¦ä½  NAS æœ‰ APIï¼‰ã€‚<br/>
        âš ï¸ åªåšä½ æœ‰æ¬Šé™/æˆæ¬Šçš„å…§å®¹ï¼Œé¿å…è¸©ç·šã€‚
      </div>

      <div class="result" id="result">ç‹€æ…‹ï¼šç­‰å¾…è¼¸å…¥â€¦</div>

      <div class="footer">
        <div>TIPï¼šä½ ä¹Ÿå¯ä»¥åœ¨ç¶²å€å¾Œé¢å¸¶åƒæ•¸ï¼š<span style="opacity:.85">download.html?type=audio&url=...</span></div>
        <div class="linklike" onclick="copyLink()">è¤‡è£½æœ¬é é€£çµ</div>
      </div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("matrix");
    const ctx = canvas.getContext("2d");
    function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
    resize(); addEventListener("resize", resize);

    const letters = "01010101COMPUTER-IDENTIFIED-ACCESS-DENIED-WELCOME-BACK".split("");
    const fontSize = 16;
    function initDrops(){
      const cols = canvas.width / fontSize;
      return Array(Math.floor(cols)).fill(1);
    }
    let drops = initDrops();
    addEventListener("resize", () => drops = initDrops());

    setInterval(() => {
      ctx.fillStyle = "rgba(0, 0, 0, 0.06)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#0f0";
      ctx.font = fontSize + "px monospace";
      drops.forEach((y, i) => {
        const t = letters[Math.floor(Math.random() * letters.length)];
        ctx.fillText(t, i * fontSize, y * fontSize);
        if (y * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
        drops[i]++;
      });
    }, 50);

    const qs = new URLSearchParams(location.search);
    const qUrl = qs.get("url") || "";
    const qType = qs.get("type") || "video";
    document.getElementById("url").value = qUrl;
    document.getElementById("type").value = (qType === "audio" ? "audio" : "video");

    function setResult(html){ document.getElementById("result").innerHTML = html; }

    function go(){
      const url = document.getElementById("url").value.trim();
      const type = document.getElementById("type").value;

      if(!url){ setResult("âš ï¸ ç‹€æ…‹ï¼šè«‹æä¾›æœ‰æ•ˆç¶²å€"); return; }

      const direct = /\.(mp3|mp4|m4a|wav|flac)(\?.*)?$/i.test(url);
      if(direct){
        setResult(`âœ… ç‹€æ…‹ï¼šç›´é€£æª”æ¡ˆåµæ¸¬æˆåŠŸ<br/>â¡ï¸ <a href="${url}" target="_blank" rel="noopener">é»æˆ‘ä¸‹è¼‰ / é–‹å•Ÿ</a>`);
        return;
      }

      // ä¼ºæœå™¨ä½ç½®è¨­å®šï¼šå·²åˆ‡æ›ç‚º Ngrok å¤–ç¶²ç©¿é€éš§é“
      const NAS_HOST = "kole-superaccurate-louetta.ngrok-free.dev";
      // ç¢ºä¿ä½¿ç”¨ https ä»¥é¿é–‹ç€è¦½å™¨ Mixed Content é˜»æ“‹
      const API_URL = `https://${NAS_HOST}/api/download`;
      
      setResult("â³ ç‹€æ…‹ï¼šä¼ºæœå™¨æ­£åœ¨è™•ç†ä¸‹è¼‰è«‹æ±‚ï¼Œæª”æ¡ˆè¼ƒå¤§æ™‚éœ€è¼ƒé•·ç­‰å¾…æ™‚é–“ï¼Œè«‹å‹¿é—œé–‰ç¶²é ...");

      fetch(API_URL, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ url, type })
      })
      .then(r => r.json())
      .then(data => {
        if(!data.ok) throw new Error(data.error || "ä¸‹è¼‰å¤±æ•—");
        
        // çµ„åˆå®Œæ•´çš„å°å¤–ä¸‹è¼‰ç¶²å€ï¼ŒåŒæ¨£ä½¿ç”¨ https
        const fullDownloadUrl = `https://${NAS_HOST}${data.download_url}`;
        setResult(`âœ… ç‹€æ…‹ï¼šè™•ç†å®Œæˆï¼<br/>â¡ï¸ <a href="${fullDownloadUrl}" target="_blank" rel="noopener">ğŸ“¥ é»æˆ‘å°‡æª”æ¡ˆä¸‹è¼‰è‡³æœ¬æ©Ÿè£ç½®</a>`);
      })
      .catch(err => {
        setResult(`âŒ ç‹€æ…‹ï¼šç„¡æ³•é€£ç·šè‡³ä¸‹è¼‰æœå‹™<br/>åŸå› ï¼š${err.message}`);
      });
    }

    function fillExample(kind){
      if(kind === "direct"){
        document.getElementById("url").value = "https://youtu.be/p7ZsBPK656s?list=PLyjhTeEl5_aowzTy0IdAyIs1784p2kGY8";
        document.getElementById("type").value = "audio";
      } else {
        document.getElementById("url").value = "https://youtu.be/p7ZsBPK656s?list=PLyjhTeEl5_aowzTy0IdAyIs1784p2kGY8";
        document.getElementById("type").value = "video";
      }
      setResult("ç‹€æ…‹ï¼šå·²å¡«å…¥ç¤ºä¾‹ï¼ŒæŒ‰ã€é–‹å§‹è™•ç†ã€å³å¯ã€‚");
    }

    async function copyLink(){
      try{
        await navigator.clipboard.writeText(location.href);
        setResult("âœ… ç‹€æ…‹ï¼šå·²è¤‡è£½æœ¬é é€£çµåˆ°å‰ªè²¼ç°¿");
      }catch(e){
        setResult("âš ï¸ ç‹€æ…‹ï¼šç€è¦½å™¨ä¸å…è¨±è¤‡è£½ï¼ˆå¯æ‰‹å‹•è¤‡è£½ç¶²å€åˆ—ï¼‰");
      }
    }

    if(qUrl) setTimeout(go, 120);
  </script>
</body>
</html>

