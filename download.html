<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ç¤¾æœƒå±€ - åª’é«”ä¸‹è¼‰æ¨¡çµ„</title>
  <style>
    /* æ ¸å¿ƒé˜²ç ´åœ–å±¬æ€§ */
    * { box-sizing: border-box; }

    body { margin: 0; background: #000; color: #0f0; font-family: 'Courier New', monospace; overflow-x: hidden; overflow-y: auto; }
    canvas { position: fixed; top: 0; left: 0; z-index: -1; opacity: 0.35; }

    /* é›»è…¦ç‰ˆä½ˆå±€ */
    .wrap { position:absolute; inset:0; display:grid; place-items:center; padding: 24px; min-height: 100vh; }
    .panel { width: 100%; max-width: 820px; border: 1px solid rgba(0,255,0,0.45); background: rgba(0, 12, 0, 0.55); box-shadow: 0 0 26px rgba(0,255,0,0.14); padding: 18px 18px 16px; backdrop-filter: blur(6px); }

    .topbar { display:flex; align-items:center; justify-content:space-between; gap: 12px; margin-bottom: 15px; }
    .title { font-size: 1.1rem; letter-spacing: 4px; color: #e8ffe8; text-shadow: 0 0 12px rgba(0,255,0,0.35); white-space: nowrap; }
    .badge { font-size: .85rem; padding: 6px 10px; border: 1px solid rgba(0,255,0,0.35); color: rgba(0,255,0,0.85); background: rgba(0,0,0,0.35); white-space: nowrap; }

    .control-group { display: flex; flex-direction: column; gap: 10px; }
    .row-url { display: flex; width: 100%; }
    .row-settings { display: flex; gap: 10px; flex-wrap: wrap; }
    
    input, select { padding: 12px; background: rgba(0,0,0,0.6); color: #0f0; border: 1px solid rgba(0,255,0,0.42); outline: none; font-size: 1rem; font-family: 'Courier New', monospace; }
    input { flex: 1; min-width: 0; }
    select { flex: 1; min-width: 140px; }

    .btn { padding: 12px 14px; border: 1px solid #0f0; background: transparent; color: #0f0; cursor: pointer; font-size: 1rem; transition: .2s; white-space: nowrap; flex: 0 0 auto; }
    .btn:hover { background: rgba(0,255,0,0.16); box-shadow: 0 0 18px rgba(0,255,0,0.45); }
    .btn:disabled { border-color: #444; color: #444; cursor: not-allowed; }
    .btn-submit { flex: 0 0 140px; font-weight: bold; background: rgba(0, 50, 0, 0.5); border-color: #0f0; }

    .subgrid { display:flex; gap:10px; margin-top: 12px; flex-wrap: wrap; }
    .btn.secondary { border-color: rgba(0,255,0,0.55); color: rgba(0,255,0,0.85); opacity: .9; padding: 10px 14px; font-size: 0.9rem; }

    .hint { margin-top: 12px; font-size: .92rem; color: rgba(0,255,0,0.72); line-height: 1.5; }
    .result { margin-top: 12px; padding: 12px; border: 1px solid rgba(0,255,0,0.35); background: rgba(0,0,0,0.38); color: #fff; line-height: 1.6; min-height: 54px; word-break: break-all; }
    .result a { color:#00BFFF; text-decoration:none; font-weight: bold; padding: 6px 12px; border: 1px solid #00BFFF; display: inline-block; margin-top: 8px; }

    .footer { margin-top: 10px; display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; font-size: .88rem; color: rgba(0,255,0,0.6); }

    /* ğŸ“± æ‰‹æ©Ÿç‰ˆå°ˆå±¬ä¿®æ­£ï¼šç¸®å°æŒ‰éˆ•èˆ‡é–“è· */
    @media (max-width: 760px){
      .wrap { padding: 12px; align-items: flex-start; padding-top: 2vh; }
      .topbar { flex-direction: column; align-items: center; gap: 8px; margin-bottom: 10px; }
      .title { font-size: 0.95rem; letter-spacing: 1px; }
      
      .row-settings { flex-direction: column; gap: 8px; }
      select { width: 100%; }
      
      .btn-submit { 
        width: 160px; /* æ”¹ç‚ºå›ºå®šå¯¬åº¦ï¼Œä¸å†æ»¿ç‰ˆ */
        margin: 0 auto; /* ç½®ä¸­ */
        padding: 10px;
        font-size: 0.95rem;
      }
      
      .subgrid { 
        display: grid;
        grid-template-columns: 1fr 1fr; /* å…©å…©ä¸€æ’ï¼Œç¯€çœç©ºé–“ */
        gap: 8px;
      }
      .btn.secondary { width: 100%; padding: 8px; font-size: 0.85rem; }
      .btn.secondary:last-child { grid-column: span 2; } /* è¿”å›æŒ‰éˆ•ä½”æ»¿ä¸€æ•´è¡Œ */
      
      .hint { font-size: 0.85rem; }
    }
  </style>
</head>
<body>
  <canvas id="matrix"></canvas>

  <div class="wrap">
    <div class="panel">
      <div class="topbar">
        <div class="title">ã€ åª’ é«” ä¸‹ è¼‰ æ¨¡ çµ„ ã€‘</div>
        <div class="badge">SECURE CHANNEL</div>
      </div>

      <div class="control-group">
        <div class="row-url">
          <input id="url" placeholder="è²¼ä¸Š YouTube ç¶²å€ æˆ– åª’é«”é€£çµ" />
        </div>
        <div class="row-settings">
          <select id="type" onchange="toggleOptions()">
            <option value="video">ğŸï¸ æ ¼å¼ï¼šå½±ç‰‡ MP4</option>
            <option value="audio">ğŸµ æ ¼å¼ï¼šéŸ³æª” MP3</option>
          </select>
          
          <select id="res_select">
            <option value="best">æœ€é«˜ç•«è³ª (4K/8K)</option>
            <option value="1080">é™åˆ¶ 1080p</option>
            <option value="720">é™åˆ¶ 720p</option>
            <option value="480">é™åˆ¶ 480p</option>
          </select>

          <select id="audio_select" style="display:none;">
            <option value="320">ç„¡æ 320k</option>
            <option value="192" selected>é«˜éŸ³è³ª 192k</option>
            <option value="128">æ¨™æº– 128k</option>
          </select>

          <button class="btn btn-submit" id="mainBtn" onclick="go()">é–‹å§‹è™•ç†</button>
        </div>
      </div>

      <div class="subgrid">
        <button class="btn secondary" onclick="fillExample('audio')">å¡«å…¥ç¯„ä¾‹ï¼šéŸ³è¨Š</button>
        <button class="btn secondary" onclick="fillExample('video')">å¡«å…¥ç¯„ä¾‹ï¼šå½±ç‰‡</button>
        <button class="btn secondary" onclick="history.back()">â† è¿”å›ä¸Šä¸€é </button>
      </div>

      <div class="hint">
        âœ” <b>ä»»å‹™ç›£æ¸¬</b>ï¼šå³æ™‚ç›£æ§ä¸‹è¼‰èˆ‡åˆ†æµé€²åº¦ã€‚<br/>
        âœ” <b>æ‰‹å‹•é ˜å–</b>ï¼šå®Œæˆå¾Œè«‹é»æ“Šç”¢ç”Ÿçš„ä¸‹è¼‰é€£çµã€‚
      </div>

      <div class="result" id="result">ç‹€æ…‹ï¼šç­‰å¾…æŒ‡ä»¤è¼¸å…¥â€¦</div>

      <div class="footer">
        <div>TIPï¼šæ”¯æ´å‹•æ…‹åˆ†æµå„²å­˜</div>
        <div style="cursor:pointer;" onclick="copyLink()">è¤‡è£½é€£çµ</div>
      </div>
    </div>
  </div>

  <script>
    /* --- çŸ©é™£èƒŒæ™¯ (ä¿æŒä¸è®Š) --- */
    const canvas = document.getElementById("matrix");
    const ctx = canvas.getContext("2d");
    function resize(){ canvas.width = innerWidth; canvas.height = innerHeight; }
    resize(); addEventListener("resize", resize);
    const letters = "01010101COMPUTER-IDENTIFIED-ACCESS-DENIED-WELCOME-BACK".split("");
    const fontSize = 16;
    let drops = Array(Math.floor(canvas.width / fontSize)).fill(1);
    setInterval(() => {
      ctx.fillStyle = "rgba(0, 0, 0, 0.06)"; ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#0f0"; ctx.font = fontSize + "px monospace";
      drops.forEach((y, i) => {
        ctx.fillText(letters[Math.floor(Math.random() * letters.length)], i * fontSize, y * fontSize);
        if (y * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
        drops[i]++;
      });
    }, 50);

    /* --- åŠŸèƒ½é‚è¼¯ --- */
    const NAS_HOST = "dl.lixiang-cloud.com";
    function toggleOptions() {
      const type = document.getElementById("type").value;
      document.getElementById("res_select").style.display = (type === "video") ? "inline-block" : "none";
      document.getElementById("audio_select").style.display = (type === "audio") ? "inline-block" : "none";
    }
    function setResult(html){ document.getElementById("result").innerHTML = html; }

    function go(){
      const url = document.getElementById("url").value.trim();
      const type = document.getElementById("type").value;
      const resolution = document.getElementById("res_select").value;
      const audio_quality = document.getElementById("audio_select").value;
      const btn = document.getElementById("mainBtn");
      if(!url){ setResult("âš ï¸ ç‹€æ…‹ï¼šç¶²å€ç„¡æ•ˆ"); return; }
      btn.disabled = true;
      setResult("â³ ç‹€æ…‹ï¼šé€£ç·šä¸­...");
      fetch(`https://${NAS_HOST}/api/download`, {
        method: "POST",
        headers: { "Content-Type": "application/json", "ngrok-skip-browser-warning": "true" },
        body: JSON.stringify({ url, type, resolution, audio_quality })
      })
      .then(r => r.json())
      .then(data => {
        if(!data.ok) throw new Error("å•Ÿå‹•å¤±æ•—");
        setResult(`ğŸ“¡ ä»»å‹™å·²å•Ÿå‹•...`);
        pollStatus(data.task_id);
      })
      .catch(err => { btn.disabled = false; setResult(`âŒ å¤±æ•—ï¼š${err.message}`); });
    }

    function pollStatus(taskId) {
      const btn = document.getElementById("mainBtn");
      const interval = setInterval(() => {
        fetch(`https://${NAS_HOST}/api/status/${taskId}`, { headers: { "ngrok-skip-browser-warning": "true" } })
        .then(r => r.json())
        .then(task => {
          if (task.status === 'completed') {
            clearInterval(interval); btn.disabled = false;
            setResult(`âœ… è™•ç†å®Œæˆï¼<br/>â¡ï¸ <a href="https://${NAS_HOST}${task.download_url}" target="_blank">ğŸ“¥ é»æˆ‘ä¸‹è¼‰</a>`);
          } else if (task.status === 'failed') {
            clearInterval(interval); btn.disabled = false; setResult(`âŒ å¤±æ•—`);
          } else if (task.status === 'processing' || task.status === 'merging') {
            const p = parseFloat(task.progress) || 0;
            setResult(`ğŸš€ åŒæ­¥ä¸­ï¼š${p}%<br/>${task.status === 'merging' ? 'âš¡ æ­£åœ¨å°è£...' : 'é€Ÿåº¦ï¼š' + (task.speed || '---')}`);
          }
        });
      }, 2000);
    }
    function fillExample(type){
      document.getElementById("url").value = "https://www.youtube.com/watch?v=WCtJ_EZQQBM";
      document.getElementById("type").value = type; toggleOptions();
    }
    async function copyLink(){ await navigator.clipboard.writeText(location.href); alert("å·²è¤‡è£½"); }
  </script>
</body>
</html>
